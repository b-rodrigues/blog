<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2020-09-27">

<title>Building apps with {shinipsum} and {golem} – Econometrics and Free Software</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-3fe3df12cb322cd60d4f50ab5ce79ec8.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-87d0f794bf36b87d4b3f18c9d77400ff.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
@import url('https://fonts.bunny.net/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=IBM+Plex+Serif:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap');
</style>
</head><body><table width="100%" height="100%" style="text-align: center;">
    <tbody><tr><td>
      <a href="https://b-rodrigues.github.io/blog/">Website</a> - 
      <a href="https://www.youtube.com/@brodriguesco">Youtube</a> - 
      <a href="https://b-rodrigues.github.io/blog/about.html">About</a> - 
      <a href="https://b-rodrigues.github.io/blog/talks.html">Talks</a> -
      <a href="https://b-rodrigues.github.io/blog/books.html">Books</a> - 
      <a href="https://b-rodrigues.github.io/blog/packages.html">Packages</a> -
      <a href="https://b-rodrigues.github.io/blog/index.xml">RSS</a>
    </td>
</tr></tbody></table>


<link rel="stylesheet" href="../styles.css">




<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Building apps with {shinipsum} and {golem}</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">programming</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 27, 2020</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<script src="../rmarkdown-libs/header-attrs/header-attrs.js"></script>
<div style="text-align:center;">
<p>
<a href="https://www.youtube.com/watch?v=B35E8QleVhg"> <img src="../assets/img/golem.png" title="Only 90's kids will get it" width="80%" height="auto"></a>
</p>
</div>
<p>
<a href="../posts/2020-09-20-shiny_raspberry.html">In my previous blog post</a> I showed you how I set up my own Shiny server using a Raspberry Pi 4B. If you visited the following <a href="../posts/2020-09-20-shiny_raspberry.html">link</a> you’ll be connecting to my Raspberry Pi and can play around with a Shiny app that I called <code>golemDemo</code>. It’s been quite a few months that I wanted to discuss this app:
</p>
{{% tweet “1277671383573704706” %}}
<p>
So the tweet mentions that a video was coming in the following week and you’ll notice that the tweet was made on… June 29th, and still no video. As I said in my previous blog post, I’ve been busy. Anyways, here’s already a blog post, and I might still do a video where I’ll go into greater detail. I think that videos are quite nice to walk an audience through an app, but it works best with an accompanying blog post where I can comment some more complicated snippets of code.
</p>
<section id="why-golem" class="level1">
<h1>
Why <code>{golem}</code>?
</h1>
<p>
Why should you consider the <code>{golem}</code> package to develop your Shiny apps? For me, there are two main reasons. First of all, I’m already familiar with package development in R, having made some little packages that I have on my Github account, and one out on CRAN (with the complete texts of Luxembourguish author <a href="https://cran.r-project.org/web/packages/michelRodange/index.html">Michel Rodange</a>) so using <code>{golem}</code> came at no additional costs. This is because a Shiny app built with <code>{golem}</code> is actually an R package! This has many advantages; all the steps of documenting, testing and sharing the app are greatly simplified. Another reason to use <code>{golem}</code> is that it forces on you a certain way of working. Now this might seem like a pretty bad thing, but I find that it is quite helpful. When you start working on a Shiny app, you might get very quickly overwhelmed with both thinking about your server logic and your UI. You might spend much time tinkering with getting the server functions working, while still not having no UI to speak of, or you might work on one part of the server and then go to the UI, then back on the server… You’ll spend hours working on the app without a clear approach, and probably waste much time because of this back and forth. The first recommended step when building a shiny app (with or without <code>{golem}</code>) is a “UI first” approach. For this, we’re going to use <code>{shinipsum}</code>
</p>
</section>
<section id="lorem-ipsum-dolor-server-amet-its-latin-for-dont-bother-with-the-server-logic-until-its-time" class="level1">
<h1>
Lorem ipsum dolor server amet (it’s Latin for “don’t bother with the server logic until it’s time”)
</h1>
<p>
The developers of <code>{golem}</code>, French company <a href="https://thinkr.fr/">ThinkR</a> suggest an “UI” first approach. The idea is to focus on the UI, and to do so using their other package called <code>{shinipsum}</code> to randomly generate elements on the server side which you can then later replace with your actual server logic. For instance, imagine that somewhere on your app, you want to show a bar plot using the <code>{ggplot2}</code> package. Using <code>{shinipsum}</code>, you can generate a random bar plot with the following line:
</p>
<pre class="r"><code>shinipsum::random_ggplot("bar")</code></pre>
<p>
<img src="../assets/img/golemDemo-2-1.png" width="80%" height="auto">
</p>
<p>
and that’s it! Now simply ignore this bit on the server, and continue focusing on the UI. You need to show a random table? No problem:
</p>
<pre class="r"><code>shinipsum::random_table(ncol = 7, nrow = 10)</code></pre>
<pre><code>##    conc rate   state conc.1 rate.1 state.1 conc.2
## 1  0.02   76 treated   0.02     76 treated   0.02
## 2  0.02   47 treated   0.02     47 treated   0.02
## 3  0.06   97 treated   0.06     97 treated   0.06
## 4  0.06  107 treated   0.06    107 treated   0.06
## 5  0.11  123 treated   0.11    123 treated   0.11
## 6  0.11  139 treated   0.11    139 treated   0.11
## 7  0.22  159 treated   0.22    159 treated   0.22
## 8  0.22  152 treated   0.22    152 treated   0.22
## 9  0.56  191 treated   0.56    191 treated   0.56
## 10 0.56  201 treated   0.56    201 treated   0.56</code></pre>
<p>
Your app might now look something like this (actually, it won’t because the little demo below is not a <code>{golem}</code> app, but it illustrates <code>{shinipsum}</code> well):
</p>
<pre class="r"><code>library(shiny)
library(reactable)
library(shinipsum)
library(ggiraph)

ui &lt;- pageWithSidebar(
  
  headerPanel("This is a shinipsum demo"),
  
  sidebarPanel(
    sliderInput("rows",
                "Number of rows:",
                min = 1,
                max = 50,
                value = 5)
  ),
  
  mainPanel(
    reactableOutput("table"),
    girafeOutput("graph")
  )
)


server &lt;- function(input, output) {

  output$table &lt;- renderReactable({
    reactable(random_table(ncol = 10, nrow = input$rows))
  })

  output$graph &lt;- renderGirafe({
    girafe(ggobj = random_ggplot("bar"))
  })
}

shinyApp(ui = ui, server = server)</code></pre>
<p>
If you have the required packages, running this on a fresh R session should start a little app.
</p>
<p>
You see that the server is only a call to <code>shinipsum::random_table</code>, and <code>shinipsum::random_ggplot</code>. Because I want a <code>reactable</code> and an interactive plot using the <code>{ggiraph}</code> package, I have already written the minimum amount of code on the server side to get things working. Now I can focus on my UI and then, when I’m done, I can start replacing the random objects from <code>{shinipsum}</code> with the actual code.
</p>
<p>
Now proceeding in this way is not a requirement of <code>{golem}</code>, but it helps to structure your thoughts and your app, and you can use this approach for any type of app. The example above, after all, is not a <code>{golem}</code> app.
</p>
</section>
<section id="get-modular-with-golem" class="level1">
<h1>
Get modular with <code>{golem}</code>
</h1>
<p>
This is now where we get to some more interesting, and <code>{golem}</code> specific things. If you’ve been using R and Shiny for the past years, you’ve probably have heard a lot about functional programming. Functional programming is a programming paradigm that encourages, and in some languages forces, the use of functions. The idea is that everything you do should be a call to a function, and functions should be chained together to achieve whatever it is you want to do; cleaning data, visualizing data, modeling data… R has many functional tools out of the box, which can be complemented using the <code>{purrr}</code> package. What does all of this have to do with Shiny and <code>{golem}</code>? Well, <code>{golem}</code> forces you to write modules to build your apps, and modules are very similar to functions (they’re actually functions). They’re bits of code that can be decoupled from your app, used in any other app, they can be linked together, they can be easily documented and tested… If you are familiar with R’s functional programming approach, modules should not be totally new to you. But if you’ve been using Shiny without module, they’ll require some getting used to.
</p>
<p>
To illustrate how a simple app can be written using modules, I have built <code>golemDemo</code>, which, as implied by its name, is a demonstration of a <code>{golem}</code> app which I hope is simple enough for anyone to start using. The app is quite simple and does only three things:
</p>
<ul>
<li>
it allows you to choose between two datasets;
</li>
<li>
it shows a table of the selected dataset;
</li>
<li>
it shows a map of Luxembourg with the data points;
</li>
</ul>
<p>
Each of these things is a module, which means that if I were to create another app with a map of Luxembourg, I could simply reuse it. But remember, the app is actually an R package. Here is the root of the app on my computer:
</p>
<pre class="r"><code>system2("ls", args = "-lFR ~/Documents/golemDemo", stdout = TRUE)</code></pre>
<pre><code>##  [1] "/home/cbrunos/Documents/golemDemo:"                                    
##  [2] "total 56"                                                              
##  [3] "-rw-r--r-- 1 cbrunos users  302 Sep 19 11:28 app.R"                    
##  [4] "drwxr-xr-x 2 cbrunos users 4096 Jun 29 17:49 data-raw/"                
##  [5] "-rw-r--r-- 1 cbrunos users  729 Sep 19 21:27 DESCRIPTION"              
##  [6] "drwxr-xr-x 2 cbrunos users 4096 Sep 11 23:39 dev/"                     
##  [7] "-rw-r--r-- 1 cbrunos users 2723 Sep 12 15:04 Dockerfile"               
##  [8] "drwxr-xr-x 3 cbrunos users 4096 Jun 28 11:33 inst/"                    
##  [9] "-rw-r--r-- 1 cbrunos users  483 Apr  8 21:38 LICENSE.md"               
## [10] "drwxr-xr-x 2 cbrunos users 4096 Sep 19 21:27 man/"                     
## [11] "-rw-r--r-- 1 cbrunos users 1420 Sep 19 21:27 NAMESPACE"                
## [12] "drwxr-xr-x 2 cbrunos users 4096 Sep 19 21:27 R/"                       
## [13] "-rw-r--r-- 1 cbrunos users 1056 Jun 28 11:38 README.Rmd"               
## [14] "drwxr-xr-x 3 cbrunos users 4096 Sep 11 17:12 rsconnect/"               
## [15] "drwxr-xr-x 3 cbrunos users 4096 Jun 28 11:48 tests/"                   
## [16] "drwxr-xr-x 2 cbrunos users 4096 Jun 28 11:48 vignettes/"               
## [17] ""                                                                      
## [18] "/home/cbrunos/Documents/golemDemo/data-raw:"                           
## [19] "total 1168"                                                            
## [20] "-rw-r--r-- 1 cbrunos users 1176106 Jun 11 09:52 communes_df.csv"       
## [21] "-rw-r--r-- 1 cbrunos users      99 Jun 28 11:48 my_dataset.R"          
## [22] "-rw-r--r-- 1 cbrunos users    1998 Jun 28 17:00 radars.csv"            
## [23] "-rw-r--r-- 1 cbrunos users    6390 Jun 28 12:31 rettungspunkte.csv"    
## [24] ""                                                                      
## [25] "/home/cbrunos/Documents/golemDemo/dev:"                                
## [26] "total 16"                                                              
## [27] "-rw-r--r-- 1 cbrunos users 1935 Jun 28 11:33 01_start.R"               
## [28] "-rw-r--r-- 1 cbrunos users 2011 Sep 11 23:39 02_dev.R"                 
## [29] "-rw-r--r-- 1 cbrunos users 1012 Jun 28 11:33 03_deploy.R"              
## [30] "-rw-r--r-- 1 cbrunos users  318 Jun 28 11:33 run_dev.R"                
## [31] ""                                                                      
## [32] "/home/cbrunos/Documents/golemDemo/inst:"                               
## [33] "total 8"                                                               
## [34] "drwxr-xr-x 3 cbrunos users 4096 Jun 28 11:33 app/"                     
## [35] "-rw-r--r-- 1 cbrunos users  140 Jun 28 11:38 golem-config.yml"         
## [36] ""                                                                      
## [37] "/home/cbrunos/Documents/golemDemo/inst/app:"                           
## [38] "total 4"                                                               
## [39] "drwxr-xr-x 2 cbrunos users 4096 Jun 28 11:48 www/"                     
## [40] ""                                                                      
## [41] "/home/cbrunos/Documents/golemDemo/inst/app/www:"                       
## [42] "total 12"                                                              
## [43] "-rw-r--r-- 1 cbrunos users    0 Jun 28 11:48 custom.css"               
## [44] "-rw-r--r-- 1 cbrunos users 3774 Jun 28 11:33 favicon.ico"              
## [45] "-rw-r--r-- 1 cbrunos users  100 Jun 28 11:48 handlers.js"              
## [46] "-rw-r--r-- 1 cbrunos users   40 Jun 28 11:48 script.js"                
## [47] ""                                                                      
## [48] "/home/cbrunos/Documents/golemDemo/man:"                                
## [49] "total 8"                                                               
## [50] "-rw-r--r-- 1 cbrunos users 261 Sep 19 21:27 pipe.Rd"                   
## [51] "-rw-r--r-- 1 cbrunos users 291 Jun 28 11:33 run_app.Rd"                
## [52] ""                                                                      
## [53] "/home/cbrunos/Documents/golemDemo/R:"                                  
## [54] "total 48"                                                              
## [55] "-rw-r--r-- 1 cbrunos users  783 Jun 28 11:33 app_config.R"             
## [56] "-rw-r--r-- 1 cbrunos users  654 Jun 29 18:34 app_server.R"             
## [57] "-rw-r--r-- 1 cbrunos users 1790 Sep 12 15:00 app_ui.R"                 
## [58] "-rw-r--r-- 1 cbrunos users    0 Jun 28 11:48 fct_helpers.R"            
## [59] "-rw-rw-r-- 1 cbrunos users  997 Jun 28 11:38 golem_utils_server.R"     
## [60] "-rw-rw-r-- 1 cbrunos users 5849 Jun 28 11:38 golem_utils_ui.R"         
## [61] "-rw-r--r-- 1 cbrunos users  549 Jun 28 11:48 mod_filter_data.R"        
## [62] "-rw-r--r-- 1 cbrunos users 3118 Sep 19 11:16 mod_load_data.R"          
## [63] "-rw-r--r-- 1 cbrunos users 2088 Jun 29 18:30 mod_map_data.R"           
## [64] "-rw-r--r-- 1 cbrunos users  910 Jun 29 18:17 mod_table_data.R"         
## [65] "-rw-r--r-- 1 cbrunos users  337 Jun 28 11:33 run_app.R"                
## [66] "-rw-r--r-- 1 cbrunos users    0 Jun 28 11:48 utils_helpers.R"          
## [67] "-rw-r--r-- 1 cbrunos users  207 Sep 19 21:27 utils-pipe.R"             
## [68] ""                                                                      
## [69] "/home/cbrunos/Documents/golemDemo/rsconnect:"                          
## [70] "total 4"                                                               
## [71] "drwxr-xr-x 3 cbrunos users 4096 Sep 11 17:12 shinyapps.io/"            
## [72] ""                                                                      
## [73] "/home/cbrunos/Documents/golemDemo/rsconnect/shinyapps.io:"             
## [74] "total 4"                                                               
## [75] "drwxr-xr-x 2 cbrunos users 4096 Sep 11 17:12 brodriguesco/"            
## [76] ""                                                                      
## [77] "/home/cbrunos/Documents/golemDemo/rsconnect/shinyapps.io/brodriguesco:"
## [78] "total 4"                                                               
## [79] "-rw-r--r-- 1 cbrunos users 219 Sep 19 21:30 golemdemo.dcf"             
## [80] ""                                                                      
## [81] "/home/cbrunos/Documents/golemDemo/tests:"                              
## [82] "total 8"                                                               
## [83] "drwxr-xr-x 2 cbrunos users 4096 Jun 28 11:48 testthat/"                
## [84] "-rw-r--r-- 1 cbrunos users   62 Jun 28 11:48 testthat.R"               
## [85] ""                                                                      
## [86] "/home/cbrunos/Documents/golemDemo/tests/testthat:"                     
## [87] "total 4"                                                               
## [88] "-rw-r--r-- 1 cbrunos users 64 Jun 28 11:48 test-app.R"                 
## [89] ""                                                                      
## [90] "/home/cbrunos/Documents/golemDemo/vignettes:"                          
## [91] "total 4"                                                               
## [92] "-rw-r--r-- 1 cbrunos users 298 Jun 28 11:48 golemDemo.Rmd"</code></pre>
<p>
The first 16 lines show the root of the folder, and then we see what’s inside each subfolder, starting with <code>data-raw/</code>, then <code>dev/</code> etc (this is done via a call to the <code>ls -lFR</code> Linux command, invoked here with R’s <code>system2()</code> function).
</p>
<p>
If you’ve already developed a package in the past, you’ll recognize the structure. What’s important here is the <code>dev/</code> folder, which is <code>{golem}</code> specific. This folder contains for files, <code>01_start.R</code>, <code>02_dev.R</code>, <code>03_deploy.R</code> and <code>run_dev.R</code>. These files are the ones that will help you develop your shiny app and you should follow the instructions contained in each of them. Let’s take a look at <code>01_start.R</code>:
</p>
<pre class="r"><code>system2("cat", args = "~/Documents/golemDemo/dev/01_start.R", stdout = TRUE)</code></pre>
<pre><code>##  [1] "# Building a Prod-Ready, Robust Shiny Application."                                     
##  [2] "# "                                                                                     
##  [3] "# README: each step of the dev files is optional, and you don't have to "               
##  [4] "# fill every dev scripts before getting started. "                                      
##  [5] "# 01_start.R should be filled at start. "                                               
##  [6] "# 02_dev.R should be used to keep track of your development during the project."        
##  [7] "# 03_deploy.R should be used once you need to deploy your app."                         
##  [8] "# "                                                                                     
##  [9] "# "                                                                                     
## [10] "########################################"                                               
## [11] "#### CURRENT FILE: ON START SCRIPT #####"                                               
## [12] "########################################"                                               
## [13] ""                                                                                       
## [14] "## Fill the DESCRIPTION ----"                                                           
## [15] "## Add meta data about your application"                                                
## [16] "golem::fill_desc("                                                                      
## [17] "  pkg_name = \"golemDemo\", # The Name of the package containing the App "              
## [18] "  pkg_title = \"PKG_TITLE\", # The Title of the package containing the App "            
## [19] "  pkg_description = \"PKG_DESC.\", # The Description of the package containing the App "
## [20] "  author_first_name = \"AUTHOR_FIRST\", # Your First Name"                              
## [21] "  author_last_name = \"AUTHOR_LAST\", # Your Last Name"                                 
## [22] "  author_email = \"AUTHOR@MAIL.COM\", # Your Email"                                     
## [23] "  repo_url = NULL # The URL of the GitHub Repo (optional) "                             
## [24] ")     "                                                                                 
## [25] ""                                                                                       
## [26] "## Set {golem} options ----"                                                            
## [27] "golem::set_golem_options()"                                                             
## [28] ""                                                                                       
## [29] "## Create Common Files ----"                                                            
## [30] "## See ?usethis for more information"                                                   
## [31] "usethis::use_mit_license( name = \"Golem User\" )  # You can set another license here"  
## [32] "usethis::use_readme_rmd( open = FALSE )"                                                
## [33] "usethis::use_code_of_conduct()"                                                         
## [34] "usethis::use_lifecycle_badge( \"Experimental\" )"                                       
## [35] "usethis::use_news_md( open = FALSE )"                                                   
## [36] ""                                                                                       
## [37] "## Use git ----"                                                                        
## [38] "usethis::use_git()"                                                                     
## [39] ""                                                                                       
## [40] "## Init Testing Infrastructure ----"                                                    
## [41] "## Create a template for tests"                                                         
## [42] "golem::use_recommended_tests()"                                                         
## [43] ""                                                                                       
## [44] "## Use Recommended Packages ----"                                                       
## [45] "golem::use_recommended_deps()"                                                          
## [46] ""                                                                                       
## [47] "## Favicon ----"                                                                        
## [48] "# If you want to change the favicon (default is golem's one)"                           
## [49] "golem::remove_favicon()"                                                                
## [50] "golem::use_favicon() # path = \"path/to/ico\". Can be an online file. "                 
## [51] ""                                                                                       
## [52] "## Add helper functions ----"                                                           
## [53] "golem::use_utils_ui()"                                                                  
## [54] "golem::use_utils_server()"                                                              
## [55] ""                                                                                       
## [56] "# You're now set! ----"                                                                 
## [57] ""                                                                                       
## [58] "# go to dev/02_dev.R"                                                                   
## [59] "rstudioapi::navigateToFile( \"dev/02_dev.R\" )"                                         
## [60] ""</code></pre>
<p>
This script is a series of calls to <code>{usethis}</code> functions; you can remove whatever you don’t need and adapt the others that you need. As you can see, I did not change much here. Execute it line by line when you’re done editing it. Once you’re done, you can go to <code>02_dev.R</code> and this is probably the script that you’ll change the most:
</p>
<pre class="r"><code>system2("cat", args = "~/Documents/golemDemo/dev/02_dev.R", stdout = TRUE)</code></pre>
<pre><code>##  [1] "# Building a Prod-Ready, Robust Shiny Application."                             
##  [2] "# "                                                                             
##  [3] "# README: each step of the dev files is optional, and you don't have to "       
##  [4] "# fill every dev scripts before getting started. "                              
##  [5] "# 01_start.R should be filled at start. "                                       
##  [6] "# 02_dev.R should be used to keep track of your development during the project."
##  [7] "# 03_deploy.R should be used once you need to deploy your app."                 
##  [8] "# "                                                                             
##  [9] "# "                                                                             
## [10] "###################################"                                            
## [11] "#### CURRENT FILE: DEV SCRIPT #####"                                            
## [12] "###################################"                                            
## [13] ""                                                                               
## [14] "# Engineering"                                                                  
## [15] ""                                                                               
## [16] "## Dependencies ----"                                                           
## [17] "## Add one line by package you want to add as dependency"                       
## [18] "usethis::use_package( \"shiny\" )"                                              
## [19] "usethis::use_package( \"shinydashboard\" )"                                     
## [20] "usethis::use_package(\"data.table\") "                                          
## [21] "usethis::use_package(\"DT\")"                                                   
## [22] "usethis::use_package(\"dplyr\")"                                                
## [23] "usethis::use_package(\"rlang\")"                                                
## [24] "usethis::use_package(\"ggiraph\")"                                              
## [25] "usethis::use_package(\"ggplot2\")"                                              
## [26] "usethis::use_package(\"htmlwidgets\")"                                          
## [27] "usethis::use_package(\"dplyr\")"                                                
## [28] "usethis::use_package(\"colorspace\")"                                           
## [29] "usethis::use_package(\"shinycssloaders\")"                                      
## [30] "usethis::use_package(\"lubridate\")"                                            
## [31] ""                                                                               
## [32] "## Add modules ----"                                                            
## [33] "## Create a module infrastructure in R/"                                        
## [34] "golem::add_module( name = \"name_of_module1\" ) # Name of the module"           
## [35] "golem::add_module( name = \"name_of_module2\" ) # Name of the module"           
## [36] ""                                                                               
## [37] "## Add helper functions ----"                                                   
## [38] "## Creates ftc_* and utils_*"                                                   
## [39] "golem::add_fct( \"helpers\" ) "                                                 
## [40] "golem::add_utils( \"helpers\" )"                                                
## [41] ""                                                                               
## [42] "## External resources"                                                          
## [43] "## Creates .js and .css files at inst/app/www"                                  
## [44] "golem::add_js_file( \"script\" )"                                               
## [45] "golem::add_js_handler( \"handlers\" )"                                          
## [46] "golem::add_css_file( \"custom\" )"                                              
## [47] ""                                                                               
## [48] "## Add internal datasets ----"                                                  
## [49] "## If you have data in your package"                                            
## [50] "usethis::use_data_raw( name = \"my_dataset\", open = FALSE ) "                  
## [51] ""                                                                               
## [52] "## Tests ----"                                                                  
## [53] "## Add one line by test you want to create"                                     
## [54] "usethis::use_test( \"app\" )"                                                   
## [55] ""                                                                               
## [56] "# Documentation"                                                                
## [57] ""                                                                               
## [58] "## Vignette ----"                                                               
## [59] "usethis::use_vignette(\"golemDemo\")"                                           
## [60] "devtools::build_vignettes()"                                                    
## [61] ""                                                                               
## [62] "## Code coverage ----"                                                          
## [63] "## (You'll need GitHub there)"                                                  
## [64] "usethis::use_github()"                                                          
## [65] "usethis::use_travis()"                                                          
## [66] "usethis::use_appveyor()"                                                        
## [67] ""                                                                               
## [68] "# You're now set! ----"                                                         
## [69] "# go to dev/03_deploy.R"                                                        
## [70] "rstudioapi::navigateToFile(\"dev/03_deploy.R\")"                                
## [71] ""</code></pre>
<p>
This is where you will list the dependencies of your package (lines 18 to 30) as well as the modules (lines 34 to 35). I have mostly used this file for the dependencies, as I already had the modules from another app, so I didn’t bother listing them here. But if I would have started from scratch, I would changed the line:
</p>
<pre><code>golem::add_module( name = \"name_of_module1\" ) # Name of the module</code></pre>
<p>
to something like:
</p>
<pre><code>golem::add_module( name = \"import_data\" ) # Name of the module</code></pre>
<p>
and executing it would have generated the needed files to start creating the module at the right spot. Let’s go see how such a module looks like (I’m skipping the third script for now, as it is only useful once you want to deploy).
</p>
<p>
You can find the modules in the <code>R/</code> folder. Let’s take a look at the module that allows the user to load the data:
</p>
<pre class="r"><code>system2("cat", args = "~/Documents/golemDemo/R/mod_load_data.R", stdout = TRUE)</code></pre>
<pre><code>##   [1] "#' load_data UI Function"                                                                                                    
##   [2] "#'"                                                                                                                          
##   [3] "#' @description A shiny Module."                                                                                             
##   [4] "#'"                                                                                                                          
##   [5] "#' @param id,input,output,session Internal parameters for {shiny}."                                                          
##   [6] "#'"                                                                                                                          
##   [7] "#' @noRd "                                                                                                                   
##   [8] "#'"                                                                                                                          
##   [9] "#' @importFrom shiny NS tagList "                                                                                            
##  [10] "#' @importFrom data.table fread"                                                                                             
##  [11] "#' @importFrom DT renderDataTable dataTableOutput"                                                                           
##  [12] "#' @importFrom dplyr filter"                                                                                                 
##  [13] "#' @importFrom rlang quo `!!` as_name"                                                                                       
##  [14] "mod_load_data_ui &lt;- function(id){"                                                                                           
##  [15] "  ns &lt;- NS(id)"                                                                                                              
##  [16] "  tagList("                                                                                                                  
##  [17] "    box(title = \"Select dataset\","                                                                                         
##  [18] "        radioButtons(ns(\"select_dataset\"),"                                                                                
##  [19] "                    label = \"Select dataset\","                                                                             
##  [20] "                    choices = c(\"Rescue points\", \"Radars\"),"                                                             
##  [21] "                    selected = c(\"Rescue points\")),"                                                                       
##  [22] "        conditionalPanel("                                                                                                   
##  [23] "          condition = paste0('input[\\'', ns('select_dataset'), \"\\'] == \\'Rescue points\\'\"),"                           
##  [24] "          selectInput(ns(\"selector_place\"), \"Place\","                                                                    
##  [25] "                      choices = c(\"test\"),"                                                                                
##  [26] "                      #choices = c(unique(output$dataset$place)),"                                                           
##  [27] "                      selected = c(\"Luxembourg, Ville (G)\"),"                                                              
##  [28] "                      multiple = TRUE)),"                                                                                    
##  [29] "        conditionalPanel("                                                                                                   
##  [30] "          condition = paste0('input[\\'', ns('select_dataset'), \"\\'] == \\'Radars\\'\"),"                                  
##  [31] "          selectInput(ns(\"selector_radar\"), \"Radar\","                                                                    
##  [32] "                      choices = c(\"test\"),"                                                                                
##  [33] "                      #choices = c(\"huhu\"),"                                                                               
##  [34] "                      selected = c(\"National road\"),"                                                                      
##  [35] "                      multiple = TRUE)),"                                                                                    
##  [36] "        width = NULL),"                                                                                                      
##  [37] "  )"                                                                                                                         
##  [38] "}"                                                                                                                           
##  [39] ""                                                                                                                            
##  [40] "#' load_data Server Function"                                                                                                
##  [41] "#'"                                                                                                                          
##  [42] "#' @noRd "                                                                                                                   
##  [43] "mod_load_data_server &lt;- function(input, output, session){"                                                                   
##  [44] "  ns &lt;- session$ns"                                                                                                          
##  [45] " "                                                                                                                           
##  [46] "  "                                                                                                                          
##  [47] "  read_dataset &lt;- reactive({"                                                                                                
##  [48] "    if(input$select_dataset == \"Rescue points\") {"                                                                         
##  [49] ""                                                                                                                            
##  [50] "      dataset &lt;- fread(\"data-raw/rettungspunkte.csv\")"                                                                     
##  [51] "      variable &lt;- quo(place)"                                                                                                
##  [52] "      filter_values &lt;- unique(dataset[, place])"                                                                             
##  [53] "    } else {"                                                                                                                
##  [54] "      dataset &lt;- fread(\"data-raw/radars.csv\")"                                                                             
##  [55] "      variable &lt;- quo(type_road)"                                                                                            
##  [56] "      filter_values &lt;- unique(dataset[, type_road])"                                                                         
##  [57] "    }"                                                                                                                       
##  [58] "    cat(\"reading data\\n\")"                                                                                                
##  [59] "    list(dataset = dataset,"                                                                                                 
##  [60] "         variable = variable,"                                                                                               
##  [61] "         filter_values = filter_values)"                                                                                     
##  [62] "  })"                                                                                                                        
##  [63] ""                                                                                                                            
##  [64] ""                                                                                                                            
##  [65] "  observe({"                                                                                                                 
##  [66] "    updateSelectInput(session, \"selector_place\", label = \"Select place:\", choices = read_dataset()$filter_values,"       
##  [67] "                      selected = \"Luxembourg, Ville (G)\")"                                                                 
##  [68] "  })"                                                                                                                        
##  [69] ""                                                                                                                            
##  [70] "  observe({"                                                                                                                 
##  [71] "    updateSelectInput(session, \"selector_radar\", label = \"Select type of road:\", choices = read_dataset()$filter_values,"
##  [72] "                      selected = \"National road\")"                                                                         
##  [73] "  })"                                                                                                                        
##  [74] ""                                                                                                                            
##  [75] "  result &lt;- reactive({"                                                                                                      
##  [76] "    return_dataset &lt;- read_dataset()$dataset"                                                                                
##  [77] ""                                                                                                                            
##  [78] "    if(\"place\" %in% colnames(return_dataset)){"                                                                            
##  [79] "      return_dataset &lt;- return_dataset %&gt;%"                                                                                  
##  [80] "        filter((!!read_dataset()$variable) %in% input$selector_place)"                                                       
##  [81] ""                                                                                                                            
##  [82] "      result &lt;- list("                                                                                                       
##  [83] "        return_dataset = return_dataset,"                                                                                    
##  [84] "        variable = quo(place)"                                                                                               
##  [85] "      )"                                                                                                                     
##  [86] "    } else {"                                                                                                                
##  [87] "      return_dataset &lt;- return_dataset %&gt;%"                                                                                  
##  [88] "        filter((!!read_dataset()$variable) %in% input$selector_radar)"                                                       
##  [89] ""                                                                                                                            
##  [90] "      result &lt;- list("                                                                                                       
##  [91] "        return_dataset = return_dataset,"                                                                                    
##  [92] "        variable = quo(type_road)"                                                                                           
##  [93] "      )"                                                                                                                     
##  [94] "    }"                                                                                                                       
##  [95] "  })"                                                                                                                        
##  [96] ""                                                                                                                            
##  [97] "  result"                                                                                                                    
##  [98] "}"                                                                                                                           
##  [99] "    "                                                                                                                        
## [100] "## To be copied in the UI"                                                                                                   
## [101] "# mod_load_data_ui(\"load_data_ui_1\")"                                                                                      
## [102] "    "                                                                                                                        
## [103] "## To be copied in the server"                                                                                               
## [104] "# callModule(mod_load_data_server, \"load_data_ui_1\")"                                                                      
## [105] " "</code></pre>
<p>
This scripts looks like a mini Shiny app; there’s a UI defined at the top of the script, and then a server defined at the bottom (I’m not describing what the module does here, I’ll do that in the video). What’s important here, is that this is a module and as such it can be reused in any app, by simply copying the right lines of code at the right spot. See lines 100 to 104 for this, which tells you exactly where to copy the lines to use this module. All the modules will look the same, and have this little explanation at the bottom to tell you where you need to copy the lines to use the modules. While building each module, you can use <code>{shinipsum}</code> instead of having to bother about the server logic, just to get things going, as explained above.
</p>
<p>
Now, finally, let’s take a look at the actual UI of the app:
</p>
<pre class="r"><code>system2("cat", args = "~/Documents/golemDemo/R/app_ui.R", stdout = TRUE)</code></pre>
<pre><code>##  [1] "#' The application User-Interface"                                                          
##  [2] "#' "                                                                                        
##  [3] "#' @param request Internal parameter for `{shiny}`. "                                       
##  [4] "#'     DO NOT REMOVE."                                                                      
##  [5] "#' @import shiny"                                                                           
##  [6] "#' @import shinydashboard"                                                                  
##  [7] "#' @noRd"                                                                                   
##  [8] "app_ui &lt;- function(request) {"                                                              
##  [9] "  tagList("                                                                                 
## [10] "                                        # Leave this function for adding external resources"
## [11] "    golem_add_external_resources(),"                                                        
## [12] "                                        # List the first level UI elements here"            
## [13] "    dashboardPage("                                                                         
## [14] "      dashboardHeader(title = \"Prototype: dashboard ecoles\"),"                            
## [15] "      dashboardSidebar("                                                                    
## [16] "        sidebarMenu("                                                                       
## [17] "          menuItem(\"Carte\", tabName = \"Carte\", icon = icon(\"map\")),"                  
## [18] "          menuItem(\"Tab 2\", tabName = \"tab_2\", icon = icon(\"chart-line\"))"            
## [19] "        )"                                                                                  
## [20] "      ),"                                                                                   
## [21] "      dashboardBody("                                                                       
## [22] "        tabItems("                                                                          
## [23] "          tabItem(tabName = \"Carte\","                                                     
## [24] "                  fluidRow("                                                                
## [25] "                    column("                                                                
## [26] "                      width = 4,"                                                           
## [27] "                      mod_load_data_ui(\"load_data_ui_1\"),"                                
## [28] "                      mod_table_data_ui(\"table_data_ui_1\")"                               
## [29] "                    ),"                                                                     
## [30] "                    column("                                                                
## [31] "                      width = 6, offset = 2,"                                               
## [32] "                      mod_map_data_ui(\"map_data_ui_1\")"                                   
## [33] "                    )"                                                                      
## [34] "                  ))"                                                                       
## [35] "        )"                                                                                  
## [36] "      )"                                                                                    
## [37] "    )"                                                                                      
## [38] "  )"                                                                                        
## [39] "}"                                                                                          
## [40] ""                                                                                           
## [41] "#' Add external Resources to the Application"                                               
## [42] "#' "                                                                                        
## [43] "#' This function is internally used to add external "                                       
## [44] "#' resources inside the Shiny application. "                                                
## [45] "#' "                                                                                        
## [46] "#' @import shiny"                                                                           
## [47] "#' @importFrom golem add_resource_path activate_js favicon bundle_resources"                
## [48] "#' @noRd"                                                                                   
## [49] "golem_add_external_resources &lt;- function(){"                                                
## [50] "  "                                                                                         
## [51] "  add_resource_path("                                                                       
## [52] "    'www', app_sys('app/www')"                                                              
## [53] "  )"                                                                                        
## [54] " "                                                                                          
## [55] "  tags$head("                                                                               
## [56] "    favicon(),"                                                                             
## [57] "    bundle_resources("                                                                      
## [58] "      path = app_sys('app/www'),"                                                           
## [59] "      app_title = 'golemDemo'"                                                              
## [60] "    )"                                                                                      
## [61] "    # Add here other external resources"                                                    
## [62] "    # for example, you can add shinyalert::useShinyalert() "                                
## [63] "  )"                                                                                        
## [64] "}"                                                                                          
## [65] ""</code></pre>
<p>
this is the “global” UI of the app. This looks like any other Shiny UI, but instead of having many many lines of code, there’s basically only calls to the UIs of each modules (see lines 27 and 28). And that’s it! It keeps your code quite small and much easier to reason about. You’ll find something even simpler for the server:
</p>
<pre class="r"><code>system2("cat", args = "~/Documents/golemDemo/R/app_server.R", stdout = TRUE)</code></pre>
<pre><code>##  [1] "#' The application server-side"                                              
##  [2] "#' "                                                                         
##  [3] "#' @param input,output,session Internal parameters for {shiny}. "            
##  [4] "#'     DO NOT REMOVE."                                                       
##  [5] "#' @import shiny"                                                            
##  [6] "#' @noRd"                                                                    
##  [7] "app_server &lt;- function( input, output, session ) {"                          
##  [8] "  # List the first level callModules here"                                   
##  [9] ""                                                                            
## [10] "  result &lt;- callModule(mod_load_data_server, \"load_data_ui_1\")"            
## [11] ""                                                                            
## [12] "  callModule(mod_table_data_server, \"table_data_ui_1\", result)"            
## [13] "  "                                                                          
## [14] ""                                                                            
## [15] "  selected_lines &lt;- reactive({"                                              
## [16] "    if(is.null(input$`table_data_ui_1-dataset_rows_selected`)){"             
## [17] "      return(TRUE)"                                                          
## [18] "    } else {"                                                                
## [19] "      as.numeric(input$`table_data_ui_1-dataset_rows_selected`)"             
## [20] "    }"                                                                       
## [21] "  })"                                                                        
## [22] ""                                                                            
## [23] "  callModule(mod_map_data_server, \"map_data_ui_1\", result, selected_lines)"
## [24] ""                                                                            
## [25] "}"</code></pre>
<p>
Line 10 calls the server side of the “load data” module, and saves the result (a data frame) into a variable called <code>result</code>. This result is then passed as an argument to the server side of table data module, which simply shows a table of the data. From lines 15 to 21, I define a variable called <code>selected-lines</code> in which the lines that the user selects in the data table are saved. This gave me some headaches, because I needed to find the right syntax. I was able to find it thanks to a Stackoverflow post that I have now lost since then… but the idea is that the indices of the selected rows are saved into a variable called <code>dataset_rows_selected</code> and this variable name must be appended to the name of the UI of the table where the table is. If no row is selected, then this object should be <code>TRUE</code>; why? Because if you filter a data frame with a condition that simply evaluates always to <code>TRUE</code>, you get all the rows back, and thus, all of the data frame. If you start selecting rows, say, rows number 2, 8 and 12, then <code>dataset_rows_selected</code> will be equal to <code>c(2, 8, 12)</code>, and the filter will return these rows.
</p>
<p>
Finally, I call the module that returns a map of Luxembourg, and pass both the data frame, saved in the <code>result</code> variable, and the <code>selected_lines</code> objects as arguments. And that’s how you make modules communicate and share data with each other, just like you would chain functions together. I won’t go through each module, but there’s several other interesting tricks that I’ll discuss during the video; for instance, I’m quite happy with the module that loads the data; the user can choose between two different dataset, and the select input will update with the right columns. This also wasn’t so easy to do, but it’ll be easier to explain during a video, so stay tuned!
</p>


</section>

</main> <!-- /main -->
<hr style="border: 1px solid #ccc; margin: 20px 0;">
<footer>
If you find the content in this blog useful, you might want to follow
me on <a href="https://fosstodon.org/@brodriguesco">Mastodon</a> or <a href="https://www.twitter.com/brodriguesco">twitter</a> for blog post updates or
<a href="https://www.buymeacoffee.com/brodriguesco">buy me an espresso</a> or <a href="https://www.paypal.me/brodriguesco">paypal.me</a>, or buy my <a href="../books.html">ebooks</a>.
You can also watch my videos on <a href="https://www.youtube.com/c/BrunoRodrigues1988/">youtube</a>.
So much content for you to consoom!
<p></p>
<style>.bmc-button img{width: 27px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-flex !important;color:#ffffff !important;background-color:#272b30 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 22px !important;letter-spacing:0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#82518c !important;}</style>
<p>
<link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/brodriguesco"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me an Espresso"><span style="margin-left:5px">Buy me an Espresso</span></a>
</p>
  <div class="row">
    <div class="col-lg-12">
        <p>© <span id="year"></span>, content by Bruno Rodrigues, unless otherwise stated, every content of this blog is licensed under the <a href="http://www.wtfpl.net/txt/copying/" rel="nofollow">WTFPL</a>.</p>
        <p>Built with <a href="https://quarto.org/">Quarto</a> and <a href="https://nixos.org/explore/">Nix</a>, hosted on <a href="https://pages.github.com/">GitHub Pages</a>.</p>
      <p><a href="../index.html">Back to main page.</a></p>
    </div>
  </div>
</footer>
<script>
 document.getElementById('year').textContent = new Date().getFullYear();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/b-rodrigues\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>