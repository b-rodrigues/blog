<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-01-13">

<title>From scripts to pipelines in the age of LLMs – Econometrics and Free Software</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/img/favicon-32x32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-3fe3df12cb322cd60d4f50ab5ce79ec8.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-587a49d30b524e4e9942e32b81edf2ae.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
@import url('https://fonts.bunny.net/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=IBM+Plex+Serif:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap');
</style>
</head><body><table width="100%" height="100%" style="text-align: center;">
    <tbody><tr><td>
      <a href="https://b-rodrigues.github.io/blog/">Website</a> - 
      <a href="https://www.youtube.com/@brodriguesco">Youtube</a> - 
      <a href="https://b-rodrigues.github.io/blog/about.html">About</a> - 
      <a href="https://b-rodrigues.github.io/blog/talks.html">Talks</a> -
      <a href="https://b-rodrigues.github.io/blog/books.html">Books</a> - 
      <a href="https://b-rodrigues.github.io/blog/packages.html">Packages</a> -
      <a href="https://b-rodrigues.github.io/blog/index.xml">RSS</a>
    </td>
</tr></tbody></table>


<link rel="stylesheet" href="../styles.css">




<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#from-implicit-to-explicit-translating-a-script-into-a-rixpress-pipeline" id="toc-from-implicit-to-explicit-translating-a-script-into-a-rixpress-pipeline" class="nav-link active" data-scroll-target="#from-implicit-to-explicit-translating-a-script-into-a-rixpress-pipeline">From implicit to explicit: translating a script into a rixpress pipeline</a></li>
  <li><a href="#generating-the-environment" id="toc-generating-the-environment" class="nav-link" data-scroll-target="#generating-the-environment">Generating the environment</a></li>
  <li><a href="#structure-context-outsourceable-grunt-work" id="toc-structure-context-outsourceable-grunt-work" class="nav-link" data-scroll-target="#structure-context-outsourceable-grunt-work">Structure + context = outsourceable grunt work</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">From scripts to pipelines in the age of LLMs</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">nix</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 13, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div style="text-align: center;">
<p>
<a> <img src="../assets/img/chad_beach.png" style="width: 80%; height: auto;"> </a>
</p>
</div>
<p>I was recently reading Davis Vaughan’s blog post <a href="https://blog.davisvaughan.com/posts/2026-01-09-claude-200-pull-requests/">Semi-automating 200 Pull Requests with Claude Code</a> and it really resonated with me, as I’ve been using LLMs for tedious tasks like that for some time now. Davis’s key insight: <em>structure = success</em>. When you can scope a task tightly and provide clear context, LLMs become genuinely useful tools.</p>
<p>If you’ve been following my work, you know that reproducible pipelines have been my main focus for some time now. It’s the reason I wrote <code>{rix}</code> for reproducible R environments, <code>{rixpress}</code> for declarative pipelines, and even a Python port called <code>ryxpress</code>. I genuinely believe these tools make data science better: more reproducible, more debuggable, more shareable.</p>
<p>But I also know that getting people to adopt new tools is hard. Learning a new way of structuring your code takes time and effort, and most people are busy enough already. Here’s where LLMs enter the picture: they can help translate your existing scripts into this more structured format. You provide your monolithic script, explain what you want, and the LLM does the grunt work of restructuring it.</p>
<p>The typical way we write analytics scripts (long chains of <code>%&gt;%</code> calls in R or method-chaining in Python) works fine for interactive exploration, but quickly turns into spaghetti that’s hard to modify, test, or debug. Take <a href="../posts/2018-11-14-luxairport.html">my old Luxembourg Airport analysis</a> as an example: it works, but turning that kind of script into a proper pipeline with caching, explicit dependencies, and testability is tedious work.</p>
<p>But we’re in 2026 where LLMs now make this trivial.</p>
<section id="from-implicit-to-explicit-translating-a-script-into-a-rixpress-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="from-implicit-to-explicit-translating-a-script-into-a-rixpress-pipeline">From implicit to explicit: translating a script into a rixpress pipeline</h2>
<p>Let me show you what I mean by translating that old Luxembourg Airport data cleaning code into a <code>{rixpress}</code> pipeline. The original script uses continuous <code>%&gt;%</code> chaining, standard tidyverse style. The <code>{rixpress}</code> version makes every intermediate step explicit.</p>
<p>But here’s the thing: LLMs don’t know about <code>{rixpress}</code> out of the box. It’s a relatively new package, and it’s not in their training data (or if it is, it’s outdated). So I wrote another tool called <a href="https://github.com/b-rodrigues/pkgctx">pkgctx</a> that extracts structured, LLM-ready API specifications from R or Python packages (and guess what, I did not write a single line of code of that tool, LLMs did).</p>
<p>The idea is simple: run <code>pkgctx r rixpress &gt; rixpress.ctx.yaml</code> and you get a compact YAML file describing every function, its arguments, and its purpose. Feed that to an LLM, and suddenly it “knows” the package. All my packages now have such a file generated on each push thanks to GitHub Actions. Here’s how my conversation went:</p>
<blockquote class="blockquote">
<p><strong>Me:</strong> I want to use a package called rixpress, but I am not familiar with it. You’ll help me, and here is a file with a detailed description of the API, for context.</p>
<p><em>[uploaded rixpress.ctx.yaml]</em></p>
<p><strong>LLM:</strong> Got it. I’ll use this API specification as the authoritative reference for <strong>rixpress</strong> and help you write correct, idiomatic pipelines with it.</p>
<p>A few orientation points to set the frame (no action required yet):</p>
<ul>
<li><strong>rixpress is declarative</strong>: you describe <em>derivations</em> (<code>rxp_r()</code>, <code>rxp_py()</code>, <code>rxp_qmd()</code>, …), then materialize them with <code>rxp_populate()</code> and <code>rxp_make()</code>.</li>
<li><strong>Data flows through the DAG</strong> via serialized artifacts (RDS / pickle / Julia Serialization), not in-memory objects.</li>
<li><strong>Language boundaries are explicit</strong> (<code>rxp_r2py()</code>, <code>rxp_py2r()</code>).</li>
<li><strong>Nix is the execution engine</strong>; <code>default.nix</code> (or equivalents) define the runtime environment.</li>
</ul>
<p>When you’re ready, tell me what you want to do […]</p>
</blockquote>
<p>Then I simply asked:</p>
<blockquote class="blockquote">
<p><strong>Me:</strong> Help me translate this R script into a rixpress pipeline: <em>[pasted the old script]</em></p>
</blockquote>
<p>And that’s how I got a working <code>{rixpress}</code> pipeline. The LLM did the tedious restructuring; I reviewed the output, made minor tweaks, and was done. The combination of <code>pkgctx</code> for context and a clear task (“translate this script”) made the LLM genuinely useful.</p>
<p>Now let’s look at what the translated pipeline looks like. First, let’s assume:</p>
<ul>
<li>The data file <code>avia_par_lu.tsv</code> is in the project directory</li>
<li>Required R packages are available via <code>default.nix</code> (we’ll also use an LLM for this one)</li>
<li>The project has been initialized with <code>rxp_init()</code> (this sets up two skeleton files to get started quickly)</li>
</ul>
<details>
<summary>
Click to expand the full rixpress pipeline
</summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rixpress)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 0: Load the data</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>avia <span class="ot">&lt;-</span> <span class="fu">rxp_r_file</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"avia_par_lu.tsv"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">read_function =</span> readr<span class="sc">::</span>read_tsv</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Select and reshape (wide → long)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>avia_long <span class="ot">&lt;-</span> <span class="fu">rxp_r</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia_long,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    avia <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="st">"unit,tra_meas,airp_pr</span><span class="sc">\\</span><span class="st">time"</span>, <span class="fu">contains</span>(<span class="st">"20"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gather</span>(date, passengers, <span class="sc">-</span><span class="st">`</span><span class="at">unit,tra_meas,airp_pr</span><span class="sc">\\</span><span class="at">time</span><span class="st">`</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Split composite key column</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>avia_split <span class="ot">&lt;-</span> <span class="fu">rxp_r</span>(</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia_split,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    avia_long <span class="sc">%&gt;%</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">separate</span>(</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">`</span><span class="at">unit,tra_meas,airp_pr</span><span class="sc">\\</span><span class="at">time</span><span class="st">`</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"unit"</span>, <span class="st">"tra_meas"</span>, <span class="st">"air_pr</span><span class="sc">\\</span><span class="st">time"</span>),</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">","</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Recode transport measure</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>avia_recode_tra_meas <span class="ot">&lt;-</span> <span class="fu">rxp_r</span>(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia_recode_tra_meas,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    avia_split <span class="sc">%&gt;%</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">tra_meas =</span> <span class="fu">fct_recode</span>(</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>          tra_meas,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers on board</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"PAS_BRD"</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers on board (arrivals)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"PAS_BRD_ARR"</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers on board (departures)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"PAS_BRD_DEP"</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers carried</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"PAS_CRD"</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers carried (arrival)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"PAS_CRD_ARR"</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers carried (departures)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"PAS_CRD_DEP"</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers seats available</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"ST_PAS"</span>,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers seats available (arrivals)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"ST_PAS_ARR"</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Passengers seats available (departures)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"ST_PAS_DEP"</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Commercial passenger air flights</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"CAF_PAS"</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Commercial passenger air flights (arrivals)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"CAF_PAS_ARR"</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Commercial passenger air flights (departures)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"CAF_PAS_DEP"</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Recode unit</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>avia_recode_unit <span class="ot">&lt;-</span> <span class="fu">rxp_r</span>(</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia_recode_unit,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    avia_recode_tra_meas <span class="sc">%&gt;%</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">unit =</span> <span class="fu">fct_recode</span>(</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>          unit,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">Passenger =</span> <span class="st">"PAS"</span>,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">Flight =</span> <span class="st">"FLIGHT"</span>,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Seats and berths</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"SEAT"</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Recode destination</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>avia_recode_destination <span class="ot">&lt;-</span> <span class="fu">rxp_r</span>(</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia_recode_destination,</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    avia_recode_unit <span class="sc">%&gt;%</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        <span class="at">destination =</span> <span class="fu">fct_recode</span>(</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">air_pr</span><span class="sc">\\</span><span class="at">time</span><span class="st">`</span>,</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">WIEN-SCHWECHAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_AT_LOWW"</span>,</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">BRUSSELS</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_BE_EBBR"</span>,</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">GENEVA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_CH_LSGG"</span>,</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">ZURICH</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_CH_LSZH"</span>,</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">FRANKFURT/MAIN</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_DE_EDDF"</span>,</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">HAMBURG</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_DE_EDDH"</span>,</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">BERLIN-TEMPELHOF</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_DE_EDDI"</span>,</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">MUENCHEN</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_DE_EDDM"</span>,</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">SAARBRUECKEN</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_DE_EDDR"</span>,</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">BERLIN-TEGEL</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_DE_EDDT"</span>,</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">KOBENHAVN/KASTRUP</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_DK_EKCH"</span>,</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">HURGHADA / INTL</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_EG_HEGN"</span>,</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">IRAKLION/NIKOS KAZANTZAKIS</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_EL_LGIR"</span>,</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">FUERTEVENTURA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ES_GCFV"</span>,</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">GRAN CANARIA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ES_GCLP"</span>,</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">LANZAROTE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ES_GCRR"</span>,</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">TENERIFE SUR/REINA SOFIA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ES_GCTS"</span>,</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">BARCELONA/EL PRAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ES_LEBL"</span>,</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">ADOLFO SUAREZ MADRID-BARAJAS</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ES_LEMD"</span>,</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">MALAGA/COSTA DEL SOL</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ES_LEMG"</span>,</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">PALMA DE MALLORCA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ES_LEPA"</span>,</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">SYSTEM - PARIS</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_FR_LF90"</span>,</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">NICE-COTE D'AZUR</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_FR_LFMN"</span>,</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">PARIS-CHARLES DE GAULLE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_FR_LFPG"</span>,</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">STRASBOURG-ENTZHEIM</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_FR_LFST"</span>,</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">KEFLAVIK</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_IS_BIKF"</span>,</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">MILANO/MALPENSA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_IT_LIMC"</span>,</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">BERGAMO/ORIO AL SERIO</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_IT_LIME"</span>,</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">ROMA/FIUMICINO</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_IT_LIRF"</span>,</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">AGADIR/AL MASSIRA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_MA_GMAD"</span>,</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">AMSTERDAM/SCHIPHOL</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_NL_EHAM"</span>,</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">WARSZAWA/CHOPINA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_PL_EPWA"</span>,</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">PORTO</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_PT_LPPR"</span>,</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">LISBOA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_PT_LPPT"</span>,</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">STOCKHOLM/ARLANDA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_SE_ESSA"</span>,</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">MONASTIR/HABIB BOURGUIBA</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_TN_DTMB"</span>,</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">ENFIDHA-HAMMAMET INTERNATIONAL</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_TN_DTNH"</span>,</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">ENFIDHA ZINE EL ABIDINE BEN ALI</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_TN_DTNZ"</span>,</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">DJERBA/ZARZIS</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_TN_DTTJ"</span>,</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">ANTALYA (MIL-CIV)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_TR_LTAI"</span>,</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">ISTANBUL/ATATURK</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_TR_LTBA"</span>,</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">SYSTEM - LONDON</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_UK_EG90"</span>,</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">MANCHESTER</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_UK_EGCC"</span>,</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">LONDON GATWICK</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_UK_EGKK"</span>,</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">LONDON/CITY</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_UK_EGLC"</span>,</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">LONDON HEATHROW</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_UK_EGLL"</span>,</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">LONDON STANSTED</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_UK_EGSS"</span>,</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">NEWARK LIBERTY INTERNATIONAL, NJ.</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_US_KEWR"</span>,</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">O.R TAMBO INTERNATIONAL</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"LU_ELLX_ZA_FAJS"</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Final cleaned dataset</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>avia_clean <span class="ot">&lt;-</span> <span class="fu">rxp_r</span>(</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia_clean,</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    avia_recode_destination <span class="sc">%&gt;%</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">passengers =</span> <span class="fu">as.numeric</span>(passengers)) <span class="sc">%&gt;%</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(unit, tra_meas, destination, date, passengers)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 7: Quarterly arrivals</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>avia_clean_quarterly <span class="ot">&lt;-</span> <span class="fu">rxp_r</span>(</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia_clean_quarterly,</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    avia_clean <span class="sc">%&gt;%</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>        tra_meas <span class="sc">==</span> <span class="st">"Passengers on board (arrivals)"</span>,</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.na</span>(passengers),</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(date, <span class="st">"Q"</span>)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">yq</span>(date))</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 8: Monthly arrivals</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>avia_clean_monthly <span class="ot">&lt;-</span> <span class="fu">rxp_r</span>(</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> avia_clean_monthly,</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    avia_clean <span class="sc">%&gt;%</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>        tra_meas <span class="sc">==</span> <span class="st">"Passengers on board (arrivals)"</span>,</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.na</span>(passengers),</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(date, <span class="st">"M"</span>)</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(<span class="fu">paste0</span>(date, <span class="st">"01"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(destination, date, passengers)</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Populate and build the pipeline</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="fu">rxp_populate</span>(</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    avia,</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    avia_long,</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    avia_split,</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    avia_recode_tra_meas,</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    avia_recode_unit,</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>    avia_recode_destination,</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    avia_clean,</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>    avia_clean_quarterly,</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>    avia_clean_monthly</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a><span class="fu">rxp_make</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>Now this is a faithful “translation” of the script into a <code>{rixpress}</code> pipeline, however, the original data is now not available anymore, and recent data sets have changed slightly, which means that this script would need further adaptation to the current data source. Otherwise, this would be it! You can view the updated script <a href="https://github.com/b-rodrigues/rixpress_demos/tree/master/avia">here</a> (I have also removed all the recoding of factors, because there seems to be something wrong with how <code>{rixpress}</code> handles <code></code> `, so writing this blog post actually help me find something to fix!)</p>
</section>
<section id="generating-the-environment" class="level2">
<h2 class="anchored" data-anchor-id="generating-the-environment">Generating the environment</h2>
<p>I also used an LLM to generate the <code>{rix}</code> script that sets up the reproducible environment for this pipeline. I gave it the <code>rix.pkgctx.yaml</code> context file (generated with <code>pkgctx r rix &gt; rix.pkgctx.yaml</code>, which is also available on the rix GitHub repo) and asked: “Using this knowledge, write me an R script that uses rix to set up the right default.nix for this pipeline.”</p>
<p>The LLM correctly identified the packages needed from the pipeline code:</p>
<ul>
<li><code>readr</code> (for <code>read_tsv</code>)</li>
<li><code>dplyr</code> (for <code>select</code>, <code>filter</code>, <code>mutate</code>, <code>%&gt;%</code>)</li>
<li><code>tidyr</code> (for <code>gather</code>, <code>separate</code>)</li>
<li><code>forcats</code> (for <code>fct_recode</code>)</li>
<li><code>lubridate</code> (for <code>yq</code>, <code>ymd</code>)</li>
<li><code>stringr</code> (for <code>str_detect</code>)</li>
<li><code>rixpress</code> (for the pipeline itself)</li>
</ul>
<p>And produced this script:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rix)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rix</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="st">"2026-01-10"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">r_pkgs =</span> <span class="fu">c</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"readr"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dplyr"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tidyr"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"forcats"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lubridate"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stringr"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rixpress"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ide =</span> <span class="st">"none"</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">project_path =</span> <span class="st">"."</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There’s only one issue with that script: the selected date is not valid, it should instead be the 12th of January. But that’s actually my fault: the LLM had no way of knowing that. The only way it could have known is if I had told it to look at the csv file that lists all the valid dates on <code>{rix}</code>’s repository. But after changing the date, it becomes possible to run this script, then <code>nix-build</code> to build the environment and <code>nix-shell</code> to drop into it. From there, run your pipeline.</p>
<p>What we’ve done here is use LLMs at every step:</p>
<ol type="1">
<li><strong>Gave context about rixpress</strong> (via <code>pkgctx</code>) and asked the LLM to translate my old script into a pipeline</li>
<li><strong>Gave context about rix</strong> (via <code>pkgctx</code>) and asked the LLM to generate the environment setup</li>
</ol>
<p>The pattern is always the same: context + scoped task = useful output.</p>
</section>
<section id="structure-context-outsourceable-grunt-work" class="level2">
<h2 class="anchored" data-anchor-id="structure-context-outsourceable-grunt-work">Structure + context = outsourceable grunt work</h2>
<p>The point I’m making here isn’t really about <code>{rixpress}</code> pipelines specifically. It’s about a broader principle that both Davis Vaughan and I have observed: LLMs are genuinely useful when you give them enough structure and context.</p>
<p>Davis <a href="https://blog.davisvaughan.com/posts/2026-01-09-claude-200-pull-requests/">pre-cloned repositories, pre-generated <code>.Rprofile</code> files, and pre-created task lists</a> so Claude could focus on the actual fixes rather than git management. I used <code>pkgctx</code> to give the LLM a complete API specification and provided a clear starting point (my old script). In both cases, the formula is the same:</p>
<blockquote class="blockquote">
<p><strong>Structure + Context → Scoped Task → LLM can actually help</strong></p>
</blockquote>
<p>I’ve <a href="../posts/2025-07-03-llm_time.html">written before</a> about how you can outsource grunt work to an LLM, but not expertise. The same applies here. I still had to know what data transformations I needed. I still had to review the output and make adjustments. But the tedious restructuring (turning a monolithic script into a declarative pipeline) is exactly the kind of work LLMs can handle if you set them up properly.</p>
<p>If you want LLMs to help with your data science work:</p>
<ol type="1">
<li><strong>Give them context.</strong> Use tools like <code>pkgctx</code> to feed them API specifications. Paste your existing code. Show them examples.</li>
<li><strong>Scope the task tightly.</strong> “Translate this script into a rixpress pipeline” is a well-defined task. “Make my code better” is not.</li>
<li><strong>Review the output.</strong> LLMs do grunt work; you provide expertise.</li>
</ol>
<p>If you’re not familiar with <code>{rixpress}</code>, check out <a href="../posts/2025-03-20-announcing_rixpress.html">my announcement post</a> or the <a href="../posts/2025-10-23-rixpress_cran.html">CRAN release post</a>. And if you want to give LLMs context about R or Python packages, <a href="https://github.com/b-rodrigues/pkgctx">pkgctx</a> is there to help. For those who want to dive deeper into Nix, <code>{rix}</code>, and <code>{rixpress}</code>, I’ve recently submitted a paper to the Journal of Statistical Software, which you can read <a href="https://b-rodrigues.github.io/rix_paper/">here</a>. For more examples of <code>{rixpress}</code> pipelines, check out the <a href="https://github.com/b-rodrigues/rixpress_demos">rixpress_demos</a> repository.</p>
<p>LLMs aren’t going anywhere: the genie is out of the bottle. I still see plenty of people online claiming that LLMs aren’t useful, but I genuinely believe it comes down to one of two things:</p>
<ul>
<li>They’re not providing enough context or scoping their tasks well enough.</li>
<li>They have a principled objection to LLMs, AI, and automation in general which, ok, whatever, but it’s not a technical argument about usefulness.</li>
</ul>
<p>Some people might even say that to feel good about themselves: <em>what I program is much too complex and important for mere LLMs to be able to help me</em>. Ok perhaps, but not all of us are working for NASA&nbsp;or whatever. I’ll keep on outsourcing the tedious grunt work to LLMs.</p>


</section>

</main> <!-- /main -->
<hr style="border: 1px solid #ccc; margin: 20px 0;">
<footer>
If you find the content in this blog useful, you might want to follow
me on <a href="https://fosstodon.org/@brodriguesco">Mastodon</a> or <a href="https://www.twitter.com/brodriguesco">twitter</a> for blog post updates or
<a href="https://www.buymeacoffee.com/brodriguesco">buy me an espresso</a> or <a href="https://www.paypal.me/brodriguesco">paypal.me</a>, or buy my <a href="../books.html">ebooks</a>.
You can also watch my videos on <a href="https://www.youtube.com/c/BrunoRodrigues1988/">youtube</a>.
So much content for you to consoom!
<p></p>
<style>.bmc-button img{width: 27px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-flex !important;color:#ffffff !important;background-color:#272b30 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 22px !important;letter-spacing:0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#82518c !important;}</style>
<p>
<link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/brodriguesco"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me an Espresso"><span style="margin-left:5px">Buy me an Espresso</span></a>
</p>
  <div class="row">
    <div class="col-lg-12">
        <p>© <span id="year"></span>, content by Bruno Rodrigues, unless otherwise stated, every content of this blog is licensed under the <a href="http://www.wtfpl.net/txt/copying/" rel="nofollow">WTFPL</a>.</p>
        <p>Built with <a href="https://quarto.org/">Quarto</a> and <a href="https://nixos.org/explore/">Nix</a>, hosted on <a href="https://pages.github.com/">GitHub Pages</a>.</p>
      <p><a href="../index.html">Back to main page.</a></p>
    </div>
  </div>
</footer>
<script>
 document.getElementById('year').textContent = new Date().getFullYear();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/b-rodrigues\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>